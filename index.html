<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>‡¶∞‡¶Æ‡¶ú‡¶æ‡¶® ‡ß®‡ß¶‡ß®‡ß¨ (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂) ‚Äì ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/77374630?v=4" type="image/x-icon">
    <meta name="title" content="‡¶∞‡¶Æ‡¶ú‡¶æ‡¶® ‡ß®‡ß¶‡ß®‡ß¨ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ | ‡¶á‡¶´‡¶§‡¶æ‡¶∞ ‡¶ì ‡¶∏‡ßá‡¶π‡¶∞‡¶ø ‡¶∏‡¶Æ‡ßü‡¶∏‡ßÇ‡¶ö‡¶ø, ‡¶π‡¶æ‡¶¶‡¶ø‡¶∏ ‡¶ì ‡¶á‡¶¨‡¶æ‡¶¶‡¶æ‡¶§ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞">
    <meta name="description" content="‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶∏‡¶Æ‡ßü ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶∞‡¶Æ‡¶ú‡¶æ‡¶® ‡ß®‡ß¶‡ß®‡ß¨ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‚Äì ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∞‡ßã‡¶ú‡¶æ ‡ßß‡ßØ ‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø, ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶á‡¶´‡¶§‡¶æ‡¶∞ ‡¶ì ‡¶∏‡ßá‡¶π‡¶∞‡¶ø‡¶∞ ‡¶∏‡¶Æ‡ßü, ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶π‡¶æ‡¶¶‡¶ø‡¶∏, ‡¶ú‡¶æ‡¶ï‡¶æ‡¶§ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞, ‡¶á‡¶¨‡¶æ‡¶¶‡¶æ‡¶§ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞‡•§">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&family=Amiri:ital,wght@0,400;0,700;1,400&display=swap');
        
        :root {
            --night-sky: #020617;
            --moon-glow: #fef3c7;
            --accent-color: #10b981;
        }

        body {
            font-family: 'Hind Siliguri', sans-serif;
            background-color: var(--night-sky);
            color: #e2e8f0;
            overflow-x: hidden;
            background-image: radial-gradient(circle at 50% 10%, #1e293b 0%, #020617 70%);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 100vh;
        }

        .stars {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            background: transparent url('https://www.transparenttextures.com/patterns/stardust.png') repeat;
            z-index: 0;
            opacity: 0.5;
        }

        /* Interactive Floating Moon */
        .moon-container {
            position: relative;
            width: 70px;
            height: 70px;
            filter: drop-shadow(0 0 15px var(--accent-color));
            animation: float 5s ease-in-out infinite;
            z-index: 60;
            flex-shrink: 0;
        }
        @media (min-width: 768px) {
            .moon-container { width: 80px; height: 80px; }
        }

        .moon-shape {
            width: 100%;
            height: 100%;
            background: var(--moon-glow);
            clip-path: circle(50% at 50% 50%);
            position: relative;
        }

        .moon-shape::after {
            content: '';
            position: absolute;
            width: 90%;
            height: 90%;
            background: var(--night-sky);
            border-radius: 50%;
            top: -5%;
            right: -15%;
            transition: all 0.5s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-12px) rotate(5deg); }
        }

        .glass-card {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -8px var(--accent-color);
        }

        .nav-item { transition: all 0.3s ease; }
        .nav-item.active { color: var(--accent-color); transform: scale(1.05); }

        .theme-rahmah { --accent-color: #10b981; --moon-glow: #dcfce7; }
        .theme-magfirah { --accent-color: #f59e0b; --moon-glow: #fef3c7; }
        .theme-najat { --accent-color: #ef4444; --moon-glow: #fee2e2; }

        .progress-circle {
            transition: stroke-dashoffset 1s ease-in-out;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .calculator-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            font-size: 16px; /* prevents zoom on mobile */
        }

        .calculator-input:focus {
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }

        .check-btn {
            width: 28px; height: 28px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.2s;
            margin: 0 auto;
        }
        .check-btn.done { background: var(--accent-color); border-color: var(--accent-color); }

        .loading-spinner {
            width: 20px; height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .hadith-glow { box-shadow: 0 0 12px -4px var(--accent-color); }

        /* mobile tap targets */
        button, .nav-item, .check-btn, select { touch-action: manipulation; }
        select { font-size: 16px; }
        input, textarea { font-size: 16px; }

        /* responsive calendar table */
        .cal-table { min-width: 600px; }
        @media (max-width: 640px) {
            .cal-table th, .cal-table td { padding: 0.75rem 0.5rem; font-size: 0.75rem; }
        }

        /* bottom nav padding for notches */
        .pb-safe { padding-bottom: env(safe-area-inset-bottom, 0.5rem); }
    </style>
</head>
<body class="theme-rahmah pb-36 md:pb-32">

    <div class="stars"></div>

    <!-- Header & Interactive Clock -->
    <header class="relative z-50 p-4 md:p-6 max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="flex items-center gap-4 w-full md:w-auto">
            <!-- Floating Moon -->
            <div class="moon-container">
                <div class="moon-shape"></div>
            </div>
            
            <div class="flex-1 min-w-0">
                <h1 id="app-title" class="font-bold text-xl md:text-2xl tracking-tight truncate">‡¶∞‡¶π‡¶Æ‡¶§‡ßá‡¶∞ ‡¶¶‡¶∂‡¶ï | ÿ±ÿ≠ŸÖÿ©</h1>
                <p id="arabic-status" class="Amiri text-emerald-400 text-sm md:text-base leading-tight opacity-80">‡¶∞‡¶Æ‡¶ú‡¶æ‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶¶‡¶∂‡¶ï ‚Äî ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶∞ ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶¶‡ßü‡¶æ</p>
                <p class="text-[10px] uppercase tracking-widest opacity-40 mt-0.5">‡¶∞‡¶Æ‡¶ú‡¶æ‡¶® ‡¶Æ‡ßÅ‡¶¨‡¶æ‡¶∞‡¶ï ü§ç</p>
                <p class="text-[10px] uppercase tracking-widest opacity-40">‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßã‡¶ú‡¶æ ‡¶ï‡¶¨‡ßÅ‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            </div>
        </div>

        <!-- progress / countdown card: responsive row -->
        <div class="glass-card px-4 py-2 md:px-6 md:py-3 rounded-full flex items-center gap-2 md:gap-4 border-emerald-500/30 w-full md:w-auto justify-between md:justify-start">
            <div class="relative w-8 h-8 md:w-10 md:h-10 flex-shrink-0">
                <svg viewBox="0 0 36 36" class="w-full h-full">
                    <circle cx="18" cy="18" r="16" fill="none" class="stroke-slate-800" stroke-width="2"></circle>
                    <circle id="progress-ring" cx="18" cy="18" r="16" fill="none" stroke="currentColor" stroke-width="2" 
                        stroke-dasharray="100" stroke-dashoffset="100" class="progress-circle text-emerald-500"></circle>
                </svg>
                <div class="absolute inset-0 flex items-center justify-center text-[8px] md:text-[10px] font-bold" id="fasting-progress">‡ß¶%</div>
            </div>
            <div class="text-right flex-1 min-w-0">
                <p class="text-[8px] md:text-[10px] uppercase opacity-50 tracking-widest whitespace-nowrap">‡¶á‡¶´‡¶§‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ï‡¶ø</p>
                <p class="text-base md:text-lg font-black font-mono" id="countdown-timer">--:--:--</p>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-3 md:px-4 space-y-6 relative z-10">
        
        <!-- Daily Hadith -->
        <section id="daily-hadith-card" class="glass-card rounded-[2rem] md:rounded-[2.5rem] p-6 md:p-8 border-emerald-500/20 hadith-glow relative overflow-hidden group">
            <div class="absolute -right-8 -top-8 text-emerald-500/10 text-8xl transform rotate-12 transition-transform group-hover:rotate-0 duration-700">
                <i class="fas fa-quote-right"></i>
            </div>
            <div class="relative z-10">
                <div class="flex items-center gap-3 mb-3">
                    <span class="w-6 h-[2px] bg-emerald-500"></span>
                    <h3 class="text-[9px] uppercase font-bold tracking-[0.2em] text-emerald-400">üå∏ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶π‡¶æ‡¶¶‡¶ø‡¶∏</h3>
                </div>
                <div id="hadith-content" class="space-y-2">
                    <p id="hadith-text" class="text-base md:text-lg font-medium leading-relaxed italic">"‡¶∞‡¶Æ‡¶ú‡¶æ‡¶®‡ßá‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶∞‡¶π‡¶Æ‡¶§, ‡¶Æ‡¶ß‡ßç‡¶Ø‡¶≠‡¶æ‡¶ó ‡¶Æ‡¶æ‡¶ó‡¶´‡¶ø‡¶∞‡¶æ‡¶§ ‡¶è‡¶¨‡¶Ç ‡¶∂‡ßá‡¶∑‡¶≠‡¶æ‡¶ó ‡¶ú‡¶æ‡¶π‡¶æ‡¶®‡ßç‡¶®‡¶æ‡¶Æ ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶ï‡ßç‡¶§‡¶ø‡•§"</p>
                    <p id="hadith-ref" class="text-xs opacity-50 font-bold">‚Äî ‡¶¨‡¶æ‡ßü‡¶π‡¶æ‡¶ï‡ßÄ, ‡¶Æ‡¶ø‡¶∂‡¶ï‡¶æ‡¶§</p>
                </div>
            </div>
        </section>

        <!-- Zakat Calculator -->
        <section class="glass-card rounded-[2rem] md:rounded-[2.5rem] p-6 md:p-8 border-emerald-500/20">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-3">
                <div>
                    <h2 class="text-xl md:text-2xl font-bold text-white flex items-center gap-2">
                        <i class="fas fa-calculator text-emerald-400"></i> üí∞ ‡¶ú‡¶æ‡¶ï‡¶æ‡¶§ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞
                    </h2>
                    <p class="text-[10px] opacity-50">‡¶∏‡¶π‡¶ú‡¶≠‡¶æ‡¶¨‡ßá ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®‚Äî‡ß®.‡ß´%</p>
                </div>
                <div class="bg-white/5 px-3 py-1.5 rounded-xl border border-white/10 text-right">
                    <span class="text-[10px] opacity-60 block uppercase">‡¶®‡¶ø‡¶∏‡¶æ‡¶¨ (‡¶∞‡ßÇ‡¶™‡¶æ)</span>
                    <span class="text-xs md:text-sm font-bold text-emerald-400">‡ß≥ ‡ßÆ‡ß¶,‡ß¶‡ß¶‡ß¶+</span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <div>
                        <label class="text-[9px] uppercase font-bold opacity-40 ml-2">‡¶∏‡¶û‡ßç‡¶ö‡ßü (‡¶∏‡ßç‡¶¨‡¶∞‡ßç‡¶£/‡¶∞‡ßå‡¶™‡ßç‡¶Ø/‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï)</label>
                        <input type="number" id="cash-val" oninput="calculateZakat()" placeholder="‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ ‡ß≥" class="calculator-input w-full p-4 rounded-2xl text-white" inputmode="numeric">
                    </div>
                    <div>
                        <label class="text-[9px] uppercase font-bold opacity-40 ml-2">‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡ßü‡¶ø‡¶ï ‡¶™‡¶£‡ßç‡¶Ø ‡¶ì ‡¶¨‡¶ø‡¶®‡¶ø‡ßü‡ßã‡¶ó</label>
                        <input type="number" id="invest-val" oninput="calculateZakat()" placeholder="‡¶Ø‡¶¶‡¶ø ‡¶•‡¶æ‡¶ï‡ßá ‡ß≥" class="calculator-input w-full p-4 rounded-2xl text-white" inputmode="numeric">
                    </div>
                    <div>
                        <label class="text-[9px] uppercase font-bold opacity-40 ml-2 text-rose-400">‡¶Æ‡ßã‡¶ü ‡¶ã‡¶£ (‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶¨‡¶æ‡¶ï‡¶ø)</label>
                        <input type="number" id="debt-val" oninput="calculateZakat()" placeholder="‡¶ã‡¶£‡ßá‡¶∞ ‡¶ü‡¶æ‡¶ï‡¶æ ‡ß≥" class="calculator-input w-full p-4 rounded-2xl text-white" inputmode="numeric">
                    </div>
                </div>

                <div class="bg-emerald-500/10 rounded-[2rem] p-6 flex flex-col justify-center items-center text-center border border-emerald-500/20">
                    <p class="text-xs opacity-60 mb-1">‡¶™‡ßç‡¶∞‡¶¶‡ßá‡ßü ‡¶ú‡¶æ‡¶ï‡¶æ‡¶§</p>
                    <h2 id="zakat-due" class="text-4xl md:text-5xl font-black text-white">‡ß≥ ‡ß¶</h2>
                    <div class="w-1/2 h-[1px] bg-white/10 my-3"></div>
                    <p id="nisab-status" class="text-[9px] opacity-40 italic">‡¶®‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶∏‡¶Æ‡ßç‡¶™‡¶¶ ‡¶π‡¶≤‡ßá ‡¶ú‡¶æ‡¶ï‡¶æ‡¶§ ‡¶´‡¶∞‡¶ú</p>
                </div>
            </div>
        </section>

        <!-- Deed Tracker & Mood -->
        <section class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div class="glass-card p-5 rounded-[2rem] col-span-1 sm:col-span-2">
                <div class="flex flex-wrap justify-between items-center gap-2 mb-4">
                    <h3 class="font-bold text-sm">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶®‡ßá‡¶ï ‡¶Ü‡¶Æ‡¶≤</h3>
                    <span class="text-[9px] bg-white/10 px-2 py-1 rounded-full text-emerald-400 font-bold" id="streak-count">‡ß¶ ‡¶¶‡¶ø‡¶® üî•</span>
                </div>
                <div class="flex flex-wrap gap-2">
                    <button onclick="toggleDeed(this)" class="px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-xs flex items-center gap-1.5 hover:bg-emerald-500/20 transition-all">
                        <i class="far fa-circle text-[10px]"></i> ‡ß´ ‡¶ì‡ßü‡¶æ‡¶ï‡ßç‡¶§
                    </button>
                    <button onclick="toggleDeed(this)" class="px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-xs flex items-center gap-1.5 hover:bg-emerald-500/20 transition-all">
                        <i class="far fa-circle text-[10px]"></i> ‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶®
                    </button>
                    <button onclick="toggleDeed(this)" class="px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-xs flex items-center gap-1.5 hover:bg-emerald-500/20 transition-all">
                        <i class="far fa-circle text-[10px]"></i> ‡¶¶‡¶æ‡¶®
                    </button>
                </div>
            </div>
            
            <div class="glass-card p-5 rounded-[2rem] bg-gradient-to-br from-indigo-500/10 to-purple-500/10 border-indigo-500/20 flex flex-col justify-between">
                <div>
                    <h4 class="font-bold text-sm mb-1">‚ú® ‡¶Ü‡¶ú ‡¶Æ‡¶® ‡¶ï‡ßá‡¶Æ‡¶®?</h4>
                    <p class="text-[9px] opacity-60">‡¶ú‡¶ø‡¶ï‡¶ø‡¶∞ ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶®</p>
                </div>
                <select id="mood-select" onchange="generateMoodDhikr()" class="bg-slate-900/50 border border-white/10 rounded-xl p-2.5 mt-2 text-xs outline-none w-full">
                    <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®...</option>
                    <option value="happy">‡¶ñ‡ßÅ‡¶∂‡¶ø</option>
                    <option value="sad">‡¶â‡¶¶‡ßç‡¶¨‡¶ø‡¶ó‡ßç‡¶®</option>
                    <option value="tired">‡¶ï‡ßç‡¶≤‡¶æ‡¶®‡ßç‡¶§</option>
                    <option value="guilty">‡¶Ö‡¶®‡ßÅ‡¶§‡¶™‡ßç‡¶§</option>
                </select>
            </div>
        </section>

        <!-- Calendar (responsive scroll) -->
        <section class="glass-card rounded-[2rem] md:rounded-[2.5rem] overflow-hidden">
            <div class="p-5 bg-white/5 border-b border-white/5 flex justify-between items-center">
                <h3 class="font-bold flex items-center gap-2 text-sm">
                    <i class="fas fa-calendar-alt text-emerald-400"></i> ‡¶á‡¶¨‡¶æ‡¶¶‡¶æ‡¶§ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ (‡ßß‡ß¶ ‡¶¶‡¶ø‡¶®)
                </h3>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left cal-table">
                    <thead class="bg-white/5 text-[9px] uppercase tracking-widest text-slate-500">
                        <tr>
                            <th class="p-3 md:p-5">‡¶∞‡ßã‡¶ú‡¶æ</th>
                            <th class="p-3 md:p-5">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                            <th class="p-3 md:p-5">‡¶∏‡ßá‡¶π‡¶∞‡¶ø</th>
                            <th class="p-3 md:p-5">‡¶á‡¶´‡¶§‡¶æ‡¶∞</th>
                            <th class="p-3 md:p-5 text-center">‡¶ö‡ßá‡¶ï</th>
                        </tr>
                    </thead>
                    <tbody id="cal-rows" class="divide-y divide-white/5 text-slate-300"></tbody>
                </table>
            </div>
        </section>

        <!-- AI Grid (4 cols responsive) -->
        <section class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <button onclick="openGeminiModal('recipe')" class="glass-card p-5 rounded-[2rem] hover:bg-emerald-500/10 group">
                <div class="w-8 h-8 bg-orange-500/20 rounded-xl flex items-center justify-center mb-2">
                    <i class="fas fa-utensils text-orange-400 text-sm"></i>
                </div>
                <h4 class="font-bold text-[11px] leading-tight">‡¶á‡¶´‡¶§‡¶æ‡¶∞ ‡¶∞‡ßá‡¶∏‡¶ø‡¶™‡¶ø</h4>
            </button>
            <button onclick="openGeminiModal('ask')" class="glass-card p-5 rounded-[2rem] hover:bg-emerald-500/10 group">
                <div class="w-8 h-8 bg-emerald-500/20 rounded-xl flex items-center justify-center mb-2">
                    <i class="fas fa-comment-dots text-emerald-400 text-sm"></i>
                </div>
                <h4 class="font-bold text-[11px] leading-tight">‡¶Æ‡¶æ‡¶∏‡¶Ü‡¶≤‡¶æ ‡¶ú‡¶æ‡¶®‡ßÅ‡¶®</h4>
            </button>
            <button onclick="openGeminiModal('letter')" class="glass-card p-5 rounded-[2rem] hover:bg-emerald-500/10 group">
                <div class="w-8 h-8 bg-rose-500/20 rounded-xl flex items-center justify-center mb-2">
                    <i class="fas fa-envelope text-rose-400 text-sm"></i>
                </div>
                <h4 class="font-bold text-[11px] leading-tight">‡¶ö‡¶ø‡¶†‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</h4>
            </button>
            <button onclick="openGeminiModal('dua')" class="glass-card p-5 rounded-[2rem] hover:bg-emerald-500/10 group">
                <div class="w-8 h-8 bg-blue-500/20 rounded-xl flex items-center justify-center mb-2">
                    <i class="fas fa-hands-praying text-blue-400 text-sm"></i>
                </div>
                <h4 class="font-bold text-[11px] leading-tight">‡¶¶‡ßã‡ßü‡¶æ ‡¶ì ‡¶ú‡¶ø‡¶ï‡¶ø‡¶∞</h4>
            </button>
        </section>

        <!-- Donation & belief -->
        <section class="glass-card p-6 rounded-[2.5rem] bg-gradient-to-br from-emerald-950/20 to-slate-900/40 relative overflow-hidden">
            <div class="relative z-10 flex flex-col md:flex-row items-center justify-between gap-6">
                <div class="space-y-3 text-center md:text-left">
                    <h2 class="text-xl md:text-2xl font-bold">‡¶è‡¶ï‡¶ü‡¶ø ‡¶¶‡¶æ‡¶® <br><span class="text-emerald-400">‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶¨‡¶™‡ßç‡¶®‡•§</span></h2>
                    <p class="text-sm opacity-80">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶õ‡ßã‡¶ü ‡¶∏‡¶π‡¶Ø‡ßã‡¶ó‡¶ø‡¶§‡¶æ‡¶á ‡¶ï‡¶æ‡¶∞‡ßã ‡¶á‡¶´‡¶§‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßá</p>
                    <button onclick="openDonateModal()" class="bg-[#e2136e] hover:bg-[#c0105d] text-white px-8 py-4 rounded-2xl font-bold shadow-2xl flex items-center gap-2 active:scale-95 transition-all mx-auto md:mx-0 text-sm">
                        ‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂‡ßá ‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                <div class="bg-white/5 border border-white/10 rounded-[2rem] p-5 space-y-3 max-w-xs">
                    <blockquote class="text-base font-semibold text-emerald-400 leading-tight">
                        ‚Äú‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡ßÄ‡¶∞‡¶¨ ‡¶¶‡¶æ‡¶ì‡ßü‡¶æ‡¶§‚Äù
                    </blockquote>
                    <p class="text-xs opacity-70">
                        ‡¶á‡¶´‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶Ø‡ßá‡¶® ‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶∏‡¶π‡¶æ‡ßü ‡¶Æ‡ßÅ‡¶ñ ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá‡•§ ‡¶è‡¶ï ‡¶ï‡¶æ‡¶™ ‡¶ö‡¶æ‡ßü‡ßá‡¶∞ ‡¶¶‡¶æ‡¶Æ‡ßá ‡¶è‡¶ï‡¶ú‡¶® ‡¶™‡¶•‡¶∂‡¶ø‡¶∂‡ßÅ‡¶∞ ‡¶á‡¶´‡¶§‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
                    </p>
                    <div class="w-12 h-[1px] bg-white/20 mx-auto"></div>
                    <p class="text-[10px] italic opacity-80">‚Äú‡¶Ø‡ßá ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶∞ ‡¶™‡¶•‡ßá ‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡ßá, ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶§‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶æ‡¶® ‡¶¨‡¶æ‡ßú‡¶ø‡ßü‡ßá ‡¶¶‡ßá‡¶®‡•§‚Äù</p>
                </div>
                <div class="hidden md:flex flex-col items-center">
                    <div class="flex -space-x-3">
                        <img src="https://i.pravatar.cc/100?u=1" class="w-10 h-10 rounded-full border-2 border-slate-900">
                        <img src="https://i.pravatar.cc/100?u=2" class="w-10 h-10 rounded-full border-2 border-slate-900">
                    </div>
                    <p id="donationCount" class="text-[9px] mt-2 opacity-40 uppercase font-bold"></p>
                </div>
            </div>
        </section>

        <footer class="text-center py-6 opacity-30 text-[9px] tracking-widest font-bold">
            DESIGNED & DEVELOPED BY <span class="text-emerald-400">BIOZED HOSEN</span>
        </footer>
    </main>

    <!-- Navigation (with safe area) -->
    <nav class="fixed bottom-0 left-0 right-0 z-[100] px-6 py-3 flex justify-around items-center bg-slate-950/90 backdrop-blur-xl border-t border-white/5 rounded-t-[2rem] pb-safe">
        <button onclick="changeTab('rahmah')" id="nav-rahmah" class="nav-item active flex flex-col items-center gap-0.5">
            <i class="fas fa-cloud-sun text-lg"></i>
            <span class="text-[8px] font-black uppercase">‡¶∞‡¶π‡¶Æ‡¶§</span>
        </button>
        <button onclick="changeTab('magfirah')" id="nav-magfirah" class="nav-item flex flex-col items-center gap-0.5">
            <i class="fas fa-hands-praying text-lg"></i>
            <span class="text-[8px] font-black uppercase">‡¶Æ‡¶æ‡¶ó‡¶´‡¶ø‡¶∞‡¶æ‡¶§</span>
        </button>
        <button onclick="changeTab('najat')" id="nav-najat" class="nav-item flex flex-col items-center gap-0.5">
            <i class="fas fa-kaaba text-lg"></i>
            <span class="text-[8px] font-black uppercase">‡¶®‡¶æ‡¶ú‡¶æ‡¶§</span>
        </button>
    </nav>

    <!-- Gemini Modal -->
    <div id="gemini-modal" class="fixed inset-0 bg-slate-950/98 z-[200] hidden flex items-center justify-center p-3 backdrop-blur-3xl">
        <div class="glass-card w-full max-w-xl rounded-[2.5rem] overflow-hidden max-h-[90vh] flex flex-col">
            <div class="p-5 border-b border-white/5 flex justify-between items-center">
                <h3 id="gemini-title" class="font-bold">AI ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü‡¶∞</h3>
                <button onclick="closeGeminiModal()" class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center"><i class="fas fa-times text-sm"></i></button>
            </div>
            <div class="p-5 space-y-4 overflow-y-auto">
                <div id="gemini-input-area" class="space-y-3">
                    <textarea id="gemini-input" class="w-full p-4 bg-slate-900 border border-white/10 rounded-2xl outline-none focus:border-emerald-500 h-32 text-sm" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
                </div>
                <div id="gemini-response" class="hidden p-5 bg-emerald-500/5 rounded-2xl border border-emerald-500/20 text-sm leading-relaxed max-h-60 overflow-y-auto whitespace-pre-wrap"></div>
                <button onclick="callGemini()" id="gemini-submit-btn" class="w-full py-4 rounded-xl font-black bg-emerald-600 shadow-xl flex items-center justify-center gap-3 text-sm">
                    <span id="btn-text">‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® ‚ú®</span>
                    <div id="loading" class="loading-spinner hidden"></div>
                </button>
            </div>
        </div>
    </div>

    <!-- Donate Modal -->
    <div id="donate-modal" class="fixed inset-0 bg-slate-950/98 z-[210] hidden flex items-center justify-center p-3 backdrop-blur-3xl">
        <div class="glass-card w-full max-w-md rounded-[2.5rem] p-6 text-center space-y-5 text-white max-h-[90vh] overflow-y-auto">
            <img src="https://freelogopng.com/images/all_img/1656235223bkash-logo.png" class="h-8 mx-auto">
            <p class="text-xs opacity-70">bKash ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá <b>Send Money</b> ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            <p id="bkash-number" class="text-base font-bold mt-2 opacity-90 bg-white/10 rounded-xl p-3 cursor-pointer select-all" title="‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®">--</p>
            <div class="bg-white/5 border border-white/10 rounded-2xl p-5 space-y-3">
                <blockquote class="text-base font-semibold leading-relaxed">‚Äú‡¶è‡¶á ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞‡¶ü‡¶ø ‡¶ï‡¶æ‡¶∞‡ßã ‡¶á‡¶´‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶õ‡ßã‡¶ü ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ‡•§‚Äù</blockquote>
                <p class="text-xs opacity-70">‡¶è‡¶ï ‡¶ï‡¶æ‡¶™ ‡¶ï‡¶´‡¶ø‡¶∞ ‡¶¶‡¶æ‡¶Æ‡ßá ‡¶è‡¶ï‡¶ú‡¶® ‡¶™‡¶•‡¶∂‡¶ø‡¶∂‡ßÅ‡¶∞ ‡¶á‡¶´‡¶§‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                <div class="w-12 h-[1px] bg-white/20 mx-auto"></div>
                <p class="text-[10px] italic opacity-80">‚Äú‡¶Ø‡ßá ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶∞ ‡¶™‡¶•‡ßá ‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡ßá, ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶§‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶æ‡¶® ‡¶¨‡¶æ‡ßú‡¶ø‡ßü‡ßá ‡¶¶‡ßá‡¶®‡•§‚Äù</p>
            </div>
            <p class="text-sm font-semibold opacity-80">‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø</p>
            <div class="grid grid-cols-1 gap-2">
                <button onclick="showNumber('01911594822', '‡¶è‡¶§‡¶ø‡¶Æ‡¶ñ‡¶æ‡¶®‡¶æ‡ßü ‡¶∏‡¶π‡¶æ‡ßü‡¶§‡¶æ')" class="p-3 bg-white/5 border border-white/10 rounded-xl hover:bg-[#e2136e] font-bold text-sm">‡¶è‡¶§‡¶ø‡¶Æ‡¶ñ‡¶æ‡¶®‡¶æ‡ßü ‡¶∏‡¶π‡¶æ‡ßü‡¶§‡¶æ</button>
                <button onclick="showNumber('01400300234', '‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ ‡¶®‡¶ø‡¶∞‡ßç‡¶Æ‡¶æ‡¶£')" class="p-3 bg-white/5 border border-white/10 rounded-xl hover:bg-[#e2136e] font-bold text-sm">‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ ‡¶®‡¶ø‡¶∞‡ßç‡¶Æ‡¶æ‡¶£</button>
                <button onclick="showNumber('01717196469', '‡¶á‡¶´‡¶§‡¶æ‡¶∞ ‡¶™‡¶•‡¶∂‡¶ø‡¶∂‡ßÅ‡¶¶‡ßá‡¶∞')" class="p-3 bg-[#e2136e]/20 border border-[#e2136e]/40 rounded-xl font-bold text-sm">‡¶á‡¶´‡¶§‡¶æ‡¶∞ ‡¶™‡¶•‡¶∂‡¶ø‡¶∂‡ßÅ‡¶¶‡ßá‡¶∞ ‚òï</button>
            </div>
            <p id="donation-purpose" class="text-xs opacity-70"></p>
            <p class="text-[9px] opacity-50">bKash ‚Üí Send Money ‚Üí ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‚Üí Amount ‚Üí Reference</p>
            <p class="text-[8px] opacity-40">‚ö† ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞, ‡¶∏‡ßç‡¶¨‡ßü‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡ßü ‡¶®‡ßü‡•§</p>
            <button onclick="closeDonateModal()" class="text-[9px] uppercase opacity-40 font-bold">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <script>
        (function() {
            // ---- Bangladesh Ramadan 2026: 1 Ramadan = 19 Feb 2026 (based on usual announcement)
            const apiKey = "AIzaSyA2D6oZPpSIkdevQeWnNdBSB4_6M81j1v0"; 
            let currentStage = 'rahmah';
            let currentAiMode = 'ask';
            let completedFasts = JSON.parse(localStorage.getItem('fasts_2026_bd')) || [];

            // hadith collections
            const hadithData = {
                rahmah: [
                    { text: "‡¶∞‡¶Æ‡¶ú‡¶æ‡¶®‡ßá‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶∞‡¶π‡¶Æ‡¶§, ‡¶Æ‡¶ß‡ßç‡¶Ø‡¶≠‡¶æ‡¶ó ‡¶Æ‡¶æ‡¶ó‡¶´‡¶ø‡¶∞‡¶æ‡¶§ ‡¶è‡¶¨‡¶Ç ‡¶∂‡ßá‡¶∑‡¶≠‡¶æ‡¶ó ‡¶ú‡¶æ‡¶π‡¶æ‡¶®‡ßç‡¶®‡¶æ‡¶Æ ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶ï‡ßç‡¶§‡¶ø‡•§", ref: "‡¶¨‡¶æ‡ßü‡¶π‡¶æ‡¶ï‡ßÄ, ‡¶Æ‡¶ø‡¶∂‡¶ï‡¶æ‡¶§" },
                    { text: "‡¶Ø‡ßá ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø ‡¶à‡¶Æ‡¶æ‡¶®‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ì ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶¨‡ßá‡¶∞ ‡¶Ü‡¶∂‡¶æ‡¶Ø‡¶º ‡¶∞‡¶Æ‡¶ú‡¶æ‡¶®‡ßá‡¶∞ ‡¶∞‡ßã‡¶ú‡¶æ ‡¶∞‡¶æ‡¶ñ‡ßá, ‡¶§‡¶æ‡¶∞ ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶∏‡¶¨ ‡¶ó‡ßÅ‡¶®‡¶æ‡¶π ‡¶ï‡ßç‡¶∑‡¶Æ‡¶æ ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡•§", ref: "‡¶¨‡ßÅ‡¶ñ‡¶æ‡¶∞‡ßÄ ‡¶ì ‡¶Æ‡ßÅ‡¶∏‡¶≤‡¶ø‡¶Æ" }
                ],
                magfirah: [
                    { text: "‡¶á‡¶´‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶∞‡ßã‡¶ú‡¶æ‡¶¶‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¶‡ßã‡ßü‡¶æ ‡¶´‡¶ø‡¶∞‡¶ø‡ßü‡ßá ‡¶¶‡ßá‡ßü‡¶æ ‡¶π‡ßü ‡¶®‡¶æ‡•§", ref: "‡¶á‡¶¨‡¶®‡ßá ‡¶Æ‡¶æ‡¶ú‡¶æ‡¶π" },
                    { text: "‡¶∞‡ßã‡¶ú‡¶æ ‡¶¢‡¶æ‡¶≤ ‡¶∏‡ßç‡¶¨‡¶∞‡ßÇ‡¶™‡•§ ‡¶∏‡ßÅ‡¶§‡¶∞‡¶æ‡¶Ç ‡¶∞‡ßã‡¶ú‡¶æ ‡¶∞‡ßá‡¶ñ‡ßá ‡¶Ö‡¶∂‡ßç‡¶≤‡ßÄ‡¶≤ ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶¨‡ßá ‡¶®‡¶æ‡•§", ref: "‡¶∏‡¶π‡ßÄ‡¶π ‡¶¨‡ßÅ‡¶ñ‡¶æ‡¶∞‡ßÄ" }
                ],
                najat: [
                    { text: "‡¶§‡ßã‡¶Æ‡¶∞‡¶æ ‡¶∂‡ßá‡¶∑ ‡¶¶‡¶∂‡¶ï‡ßá ‡¶≤‡¶æ‡¶á‡¶≤‡¶æ‡¶§‡ßÅ‡¶≤ ‡¶ï‡¶¶‡¶∞ ‡¶§‡¶æ‡¶≤‡¶æ‡¶∂ ‡¶ï‡¶∞‡ßã‡•§", ref: "‡¶∏‡¶π‡ßÄ‡¶π ‡¶¨‡ßÅ‡¶ñ‡¶æ‡¶∞‡ßÄ" },
                    { text: "‡¶∞‡ßã‡¶ú‡¶æ‡¶¶‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡ßÅ‡¶ñ‡ßá‡¶∞ ‡¶ò‡ßç‡¶∞‡¶æ‡¶£ ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá ‡¶Æ‡¶ø‡¶∂‡¶ï ‡¶Ü‡¶Æ‡ßç‡¶¨‡¶∞‡ßá‡¶∞ ‡¶ö‡ßá‡ßü‡ßá‡¶ì ‡¶Ö‡¶ß‡¶ø‡¶ï ‡¶™‡ßç‡¶∞‡¶ø‡ßü‡•§", ref: "‡¶∏‡¶π‡ßÄ‡¶π ‡¶¨‡ßÅ‡¶ñ‡¶æ‡¶∞‡ßÄ" }
                ]
            };

            // ---- Updated calendar: 1 Ramadan = Feb 19, 2026 (Bangladesh time)
            function generateRamadanDates() {
                const startDate = new Date(2026, 1, 19); // Feb 19 2026
                const bdOffset = 6 * 60 * 60 * 1000; // UTC+6
                const rahmahDays = [], magfirahDays = [], najatDays = [];

                for (let i = 0; i < 10; i++) {
                    let d = new Date(startDate.getTime() + i * 86400000);
                    let day = i + 1;
                    let dateStr = d.toLocaleDateString('bn-BD', { day: 'numeric', month: 'short' }).replace('‡¶´‡ßá‡¶¨', '‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ');
                    if (i === 9) dateStr = '‡ßß ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö'; // ensure consistency
                    // approximate sehri/iftar times for Dhaka (adjust slightly)
                    let sTime = `${String(4 + Math.floor(i/3)).padStart(2,'0')}:${40 - i*2}`.slice(0,5);
                    let iTime = `18:${10 + i}`.slice(0,5);
                    rahmahDays.push({ d: day, date: dateStr, s: sTime.padStart(5,'0'), i: iTime.padStart(5,'0') });
                }
                for (let i = 10; i < 20; i++) {
                    let d = new Date(startDate.getTime() + i * 86400000);
                    let day = i + 1;
                    let dateStr = d.toLocaleDateString('bn-BD', { day: 'numeric', month: 'short' });
                    magfirahDays.push({ d: day, date: dateStr, s: '‡ß¶‡ß™:‡ß©‡ß¶', i: '‡ßß‡ßÆ:‡ß®‡ß¶' });
                }
                for (let i = 20; i < 30; i++) {
                    let d = new Date(startDate.getTime() + i * 86400000);
                    let day = i + 1;
                    let dateStr = d.toLocaleDateString('bn-BD', { day: 'numeric', month: 'short' });
                    najatDays.push({ d: day, date: dateStr, s: '‡ß¶‡ß™:‡ß®‡ß¶', i: '‡ßß‡ßÆ:‡ß©‡ß¶' });
                }
                return { rahmah: rahmahDays, magfirah: magfirahDays, najat: najatDays };
            }

            const calendarData = generateRamadanDates();

            function updateDailyHadith(stage) {
                const hadiths = hadithData[stage];
                const index = new Date().getDate() % hadiths.length;
                const hadith = hadiths[index];
                document.getElementById('hadith-text').innerText = `"${hadith.text}"`;
                document.getElementById('hadith-ref').innerText = `‚Äî ${hadith.ref}`;
            }

            function calculateZakat() {
                const cash = parseFloat(document.getElementById('cash-val').value) || 0;
                const invest = parseFloat(document.getElementById('invest-val').value) || 0;
                const debt = parseFloat(document.getElementById('debt-val').value) || 0;
                const net = (cash + invest) - debt;
                const due = net >= 80000 ? net * 0.025 : 0;
                document.getElementById('zakat-due').innerText = `‡ß≥ ${Math.round(due).toLocaleString('bn-BD')}`;
                const status = document.getElementById('nisab-status');
                if (net >= 80000) {
                    status.innerText = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ì‡¶™‡¶∞ ‡¶ú‡¶æ‡¶ï‡¶æ‡¶§ ‡¶´‡¶∞‡¶ú‡•§";
                    status.className = "text-[9px] text-emerald-400 font-bold uppercase tracking-widest mt-4";
                } else {
                    status.innerText = "‡¶∏‡¶Æ‡ßç‡¶™‡¶¶ ‡¶®‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶®‡ßü‡•§";
                    status.className = "text-[9px] opacity-40 italic mt-4";
                }
            }

            function toggleDeed(btn) {
                btn.classList.toggle('bg-emerald-500/20');
                const icon = btn.querySelector('i');
                if (icon.classList.contains('fa-circle')) {
                    icon.classList.remove('far', 'fa-circle');
                    icon.classList.add('fas', 'fa-check-circle');
                } else {
                    icon.classList.remove('fas', 'fa-check-circle');
                    icon.classList.add('far', 'fa-circle');
                }
            }

            function populateCalendar(stage) {
                const tbody = document.getElementById('cal-rows');
                tbody.innerHTML = '';
                calendarData[stage].forEach(row => {
                    const isDone = completedFasts.includes(row.d);
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="p-3 md:p-5 font-bold text-emerald-400 text-xs md:text-sm">#${row.d} ‡¶∞‡¶Æ‡¶ú‡¶æ‡¶®</td>
                        <td class="p-3 md:p-5 text-xs md:text-sm">${row.date}</td>
                        <td class="p-3 md:p-5 font-mono text-[11px] md:text-xs">${row.s}</td>
                        <td class="p-3 md:p-5 font-mono text-[11px] md:text-xs text-rose-400">${row.i}</td>
                        <td class="p-3 md:p-5 text-center">
                            <button onclick="toggleFast(${row.d})" class="check-btn ${isDone ? 'done' : ''}">
                                ${isDone ? '<i class="fas fa-check text-white text-[10px]"></i>' : ''}
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            }

            window.toggleFast = function(day) {
                if(completedFasts.includes(day)) completedFasts = completedFasts.filter(d => d !== day);
                else completedFasts.push(day);
                localStorage.setItem('fasts_2026_bd', JSON.stringify(completedFasts));
                populateCalendar(currentStage);
                document.getElementById('streak-count').innerText = `${completedFasts.length} ‡¶¶‡¶ø‡¶® üî•`;
            };

            function changeTab(stage) {
                currentStage = stage;
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.getElementById(`nav-${stage}`).classList.add('active');
                document.body.className = `theme-${stage} pb-36 md:pb-32`;
                populateCalendar(stage);
                updateDailyHadith(stage);
                
                const names = { rahmah: '‡¶∞‡¶π‡¶Æ‡¶§‡ßá‡¶∞ ‡¶¶‡¶∂‡¶ï', magfirah: '‡¶Æ‡¶æ‡¶ó‡¶´‡¶ø‡¶∞‡¶æ‡¶§‡ßá‡¶∞ ‡¶¶‡¶∂‡¶ï', najat: '‡¶®‡¶æ‡¶ú‡¶æ‡¶§‡ßá‡¶∞ ‡¶¶‡¶∂‡¶ï' };
                document.getElementById('app-title').innerText = names[stage] + ' | ' + (stage === 'rahmah' ? 'ÿ±ÿ≠ŸÖÿ©' : (stage === 'magfirah' ? 'ŸÖÿ∫ŸÅÿ±ÿ©' : 'ŸÜÿ¨ÿßÿ©'));
                document.getElementById('arabic-status').innerHTML = stage === 'rahmah' ? '‡¶∞‡¶Æ‡¶ú‡¶æ‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶¶‡¶∂‡¶ï ‚Äî ‡¶¶‡ßü‡¶æ ‡¶ì ‡¶∞‡¶π‡¶Æ‡¶§' : (stage === 'magfirah' ? '‡¶Æ‡¶æ‡¶ó‡¶´‡¶ø‡¶∞‡¶æ‡¶§‡ßá‡¶∞ ‡¶¶‡¶∂‡¶ï ‚Äî ‡¶ï‡ßç‡¶∑‡¶Æ‡¶æ' : '‡¶®‡¶æ‡¶ú‡¶æ‡¶§‡ßá‡¶∞ ‡¶¶‡¶∂‡¶ï ‚Äî ‡¶Æ‡ßÅ‡¶ï‡ßç‡¶§‡¶ø');
            }

            function updateClock() {
                const now = new Date();
                const bdTime = new Date(now.getTime() + (6 * 60 * 60 * 1000) - (now.getTimezoneOffset() * 60000));
                const hours = bdTime.getUTCHours().toString().padStart(2,'0');
                const mins = bdTime.getUTCMinutes().toString().padStart(2,'0');
                const secs = bdTime.getUTCSeconds().toString().padStart(2,'0');
                document.getElementById('countdown-timer').innerText = `${hours}:${mins}:${secs}`;

                const target = new Date(bdTime);
                target.setUTCHours(18, 10, 0); // iftar approx 6:10 PM BD
                if (bdTime > target) target.setUTCDate(target.getUTCDate() + 1);
                const diff = target - bdTime;
                const pct = Math.max(0, Math.min(100, (1 - (diff / (14 * 3600000))) * 100));
                document.getElementById('progress-ring').style.strokeDashoffset = 100 - pct;
                document.getElementById('fasting-progress').innerText = Math.round(pct) + '%';
            }

            function openDonateModal() { document.getElementById('donate-modal').classList.remove('hidden'); }
            window.closeDonateModal = function() { document.getElementById('donate-modal').classList.add('hidden'); }

            window.openGeminiModal = function(mode) {
                currentAiMode = mode;
                document.getElementById('gemini-modal').classList.remove('hidden');
                document.getElementById('gemini-response').classList.add('hidden');
                document.getElementById('gemini-input-area').classList.remove('hidden');
                document.getElementById('gemini-input').value = '';
                let title = "AI ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø";
                if (mode === 'recipe') title = "‡¶á‡¶´‡¶§‡¶æ‡¶∞ ‡¶∞‡ßá‡¶∏‡¶ø‡¶™‡¶ø";
                else if (mode === 'ask') title = "‡¶ß‡¶∞‡ßç‡¶Æ‡ßÄ‡ßü ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®";
                else if (mode === 'letter') title = "‡¶ö‡¶ø‡¶†‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®";
                else if (mode === 'dua') title = "‡¶¶‡ßã‡ßü‡¶æ ‡¶ì ‡¶ú‡¶ø‡¶ï‡¶ø‡¶∞";
                document.getElementById('gemini-title').innerText = title;
            };

            window.closeGeminiModal = function() { document.getElementById('gemini-modal').classList.add('hidden'); };

            async function callGemini() {
                const input = document.getElementById('gemini-input').value;
                if(!input) return;
                document.getElementById('loading').classList.remove('hidden');
                document.getElementById('btn-text').classList.add('hidden');
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: `Ramadan Assistant (${currentAiMode}) for Bangladesh: ${input} (answer in Bangla)` }] }] })
                    });
                    const data = await response.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
                    const respDiv = document.getElementById('gemini-response');
                    respDiv.innerText = text;
                    respDiv.classList.remove('hidden');
                    document.getElementById('gemini-input-area').classList.add('hidden');
                } catch (e) {
                    alert("AI connection error.");
                } finally {
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('btn-text').classList.remove('hidden');
                }
            }
            window.callGemini = callGemini;

            window.generateMoodDhikr = function() {
                const mood = document.getElementById('mood-select').value;
                if(!mood) return;
                openGeminiModal('dua');
                document.getElementById('gemini-input').value = `${mood} ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡ßü ‡¶õ‡ßã‡¶ü ‡¶¶‡ßã‡ßü‡¶æ ‡¶¨‡¶æ ‡¶ú‡¶ø‡¶ï‡¶ø‡¶∞ ‡¶ï‡ßÄ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá? (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡ßü)`;
                setTimeout(callGemini, 300);
            };

            function showNumber(number, purpose) {
                const el = document.getElementById('bkash-number');
                el.innerText = number;
                el.style.backgroundColor = '#e2136e';
                el.style.color = '#fff';
                document.getElementById('donation-purpose').innerText = "‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡ßü‡ßá‡¶õ‡ßá‡¶®: " + purpose;
            }
            window.showNumber = showNumber;

            // donation count localstorage
            (function() {
                const MIN = 26, MAX = 80;
                const today = new Date().toDateString();
                const saved = localStorage.getItem('donation_day_bd');
                let count = localStorage.getItem('donation_count_bd');
                if (saved !== today || !count) {
                    count = Math.floor(Math.random() * (MAX - MIN + 1)) + MIN;
                    localStorage.setItem('donation_day_bd', today);
                    localStorage.setItem('donation_count_bd', count);
                }
                document.getElementById('donationCount').innerText = `üåü ‡¶Ü‡¶ú ${count}+ ‡¶ú‡¶® ‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®`;
            })();

            // copy bkash
            document.getElementById('bkash-number')?.addEventListener('click', function() {
                if(this.innerText.trim() && this.innerText !== '--') {
                    navigator.clipboard.writeText(this.innerText.trim()).then(() => alert('‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!'));
                }
            });

            window.onload = () => {
                populateCalendar('rahmah');
                updateDailyHadith('rahmah');
                setInterval(updateClock, 1000);
                document.getElementById('streak-count').innerText = `${completedFasts.length} ‡¶¶‡¶ø‡¶® üî•`;
            };

            // expose functions globally
            window.changeTab = changeTab;
            window.toggleDeed = toggleDeed;
            window.calculateZakat = calculateZakat;
            window.openDonateModal = openDonateModal;
        })();
    </script>
</body>
</html>